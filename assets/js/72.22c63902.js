(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{490:function(s,e,n){"use strict";n.r(e);var a=n(22),v=Object(a.a)({},(function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"shell-中-和-的区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#shell-中-和-的区别"}},[s._v("#")]),s._v(" shell 中 && 和 & 的区别")]),s._v(" "),n("h2",{attrs:{id:"结论先上"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#结论先上"}},[s._v("#")]),s._v(" 结论先上")]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),n("p",[s._v("在"),n("code",[s._v("bash")]),s._v("命令或"),n("code",[s._v("npm script")]),s._v("中使用"),n("code",[s._v("&")]),s._v("来实现"),n("code",[s._v("并发")]),s._v("效果时，实际上是把"),n("code",[s._v("&")]),s._v("左侧的命令丢入后台运行，右侧剩余命令看做 "),n("em",[n("strong",[s._v("整体")])]),s._v(" 任务在前台运行，以此来实现并发效果。")]),s._v(" "),n("p",[s._v("而"),n("code",[s._v("&&")]),s._v("是串行执行两侧命令，先执行完左侧后再执行右侧。")]),s._v(" "),n("p",[n("em",[n("strong",[s._v("切记！！！")])])])]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("command1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" command2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" command3\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),n("p",[s._v("并不是并发执行"),n("code",[s._v("command1")]),s._v("和"),n("code",[s._v("command2")]),s._v("后再执行"),n("code",[s._v("command3")])]),s._v(" "),n("p",[s._v("而是并发执行"),n("code",[s._v("command1")]),s._v("和"),n("code",[s._v("command2 && command3")])])]),s._v(" "),n("h2",{attrs:{id:"过程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#过程"}},[s._v("#")]),s._v(" 过程")]),s._v(" "),n("p",[s._v("最近，我组在远端构建组内"),n("code",[s._v("sdk")]),s._v("时踩了个坑！！！原先我们是"),n("code",[s._v("ci")]),s._v("构建好"),n("code",[s._v("sdk")]),s._v("，推送到服务器上，发现经常会出现推过去的"),n("code",[s._v("zip")]),s._v("包文件不全，或者文件全了但是文件的内容不全。很是神奇。")]),s._v(" "),n("p",[s._v("排查一番后发现，我们"),n("code",[s._v("package.json")]),s._v("中的"),n("code",[s._v("scripts")]),s._v("写了个大概如下的命令")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cross-env npm run build-core & npm run build-ui\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("并把这个命令用 "),n("code",[s._v("npm run build")]),s._v(" 代替。")]),s._v(" "),n("p",[s._v("嗯~看着没问题，并行的构建"),n("code",[s._v("sdk-core")]),s._v("以及"),n("code",[s._v("sdk-ui")]),s._v("。")]),s._v(" "),n("p",[s._v("构建好后就应该是打包，我们却在"),n("code",[s._v("ci")]),s._v("里面写了个“致命”的命令")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run build "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" node publish.js\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("code",[s._v("publish.js")]),s._v("就是我们用来发布到的脚本文件。看上去也是没问题。。但是细想一下，整个命令就变成了这样")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("cross-env "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run build-core "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run build-ui "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" node publish.js\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("这里就踩到了一个坑！！！！")]),s._v(" "),n("p",[s._v("我们原来是想先并行的构建"),n("code",[s._v("ui")]),s._v("与"),n("code",[s._v("core")]),s._v("，完成后执行上传脚本。。但是这里却变成了并行执行下面两件事")]),s._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v(" 构建core\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v(" 构建ui和发布\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("这里我们可以粗略地理解为"),n("code",[s._v("&&")]),s._v("的优先级更高所以导致了这种现象。")]),s._v(" "),n("p",[s._v("但其实是"),n("code",[s._v("bash")]),s._v("中"),n("code",[s._v("&")]),s._v("命令的特殊性导致的，前面我对“并行”做了特殊高亮，是因为表现上是并行的，但是"),n("code",[s._v("&")]),s._v("命令的含义并不是并行的执行任务。")]),s._v(" "),n("p",[n("code",[s._v("&")]),s._v("命令的真实含义是把左侧的任务立即进入后台执行，这样就是实现了"),n("code",[s._v("&")]),s._v("两侧任务同时并发执行的效果，实际上会导致上面说的不符合期望的原因并不是因为优先级问题，按我们的理解"),n("code",[s._v("&")]),s._v("作为运算符的话优先级是高于"),n("code",[s._v("&&")]),s._v("的，之所以会造成上面的原因是因为命令按顺序执行的话，"),n("code",[s._v("&")]),s._v("使得左侧任务瞬间进入后台执行，右侧剩余命令就看做一个整体任务了。")]),s._v(" "),n("h2",{attrs:{id:"show-demo"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#show-demo"}},[s._v("#")]),s._v(" show demo")]),s._v(" "),n("p",[s._v("准备好4个文件"),n("code",[s._v("index1.js")]),s._v(","),n("code",[s._v("index2.js")]),s._v(","),n("code",[s._v("index3.js")]),s._v("以及"),n("code",[s._v("package.json")]),s._v("。")]),s._v(" "),n("p",[s._v("内容分别如下")]),s._v(" "),n("p",[s._v("index1.js：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("console.log('start index1');\n\nsetTimeout(() => {\n  console.log('end index1');\n}, 6000);\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("index2.js：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("console.log('start index2');\n\nsetTimeout(() => {\n  console.log('end index2');\n}, 3000);\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("index3.js：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("console.log('start index3');\n\nsetTimeout(() => {\n  console.log('end index3');\n}, 500);\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("package.json：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('{\n  "name": "npm-script",\n  "version": "1.0.0",\n  "main": "index.js",\n  "license": "MIT",\n  "scripts": {\n    "test":"node index1.js & node index2.js && node index3.js"\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("接着我们运行"),n("code",[s._v("npm test")]),s._v("。")]),s._v(" "),n("p",[s._v("神奇的事情发生了！！！")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("node index1.js & node index2.js && node index3.js\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("错误的理解上面的执行顺序的话，期望结果应该是在"),n("code",[s._v("index1")]),s._v("和"),n("code",[s._v("index2")]),s._v("结束后才开始"),n("code",[s._v("index3")]),s._v("，实际输出否决了这个想法。")]),s._v(" "),n("p",[s._v("那把"),n("code",[s._v("&")]),s._v("当做并行运算符而"),n("code",[s._v("&&")]),s._v("的优先级更高的话，结果应该是就是"),n("code",[s._v("index3")]),s._v("是在"),n("code",[s._v("index2")]),s._v("后开始，而"),n("code",[s._v("index1")]),s._v("和"),n("code",[s._v("index2")]),s._v("是并行开始，看上面的图确实很像，但有个神奇的地方是，终端已经输出"),n("code",[s._v("done")]),s._v("了，退出了，过了一会才再次输出"),n("code",[s._v("end index1")]),s._v("！！")]),s._v(" "),n("p",[s._v("确实很神奇，但结合上面说的"),n("code",[s._v("&")]),s._v("的原理就能理解。")]),s._v(" "),n("p",[s._v("先把"),n("code",[s._v("index1")]),s._v("扔到后台执行，当前终端执行"),n("code",[s._v("&")]),s._v("右边的命令，跑完"),n("code",[s._v("index2")]),s._v("后跑"),n("code",[s._v("index3")]),s._v("，然后结束当前终端，此时在后台的"),n("code",[s._v("index1")]),s._v("可能还没执行完。")]),s._v(" "),n("p",[s._v("文本摘自：\n"),n("a",{attrs:{href:"https://juejin.im/post/5b81275d51882542d02cc929",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://juejin.im/post/5b81275d51882542d02cc929"),n("OutboundLink")],1)])])}),[],!1,null,null,null);e.default=v.exports}}]);